{#include base}
{#title}Configuration Health - PostgreSQL Console{/title}

<div id="refreshable-content" hx-get="/config-health?instance={currentInstance ?: 'default'}" hx-trigger="refresh" hx-swap="innerHTML" hx-select="#refreshable-content > *">

<div class="row mb-4">
    <div class="col">
        <h1>Configuration Health</h1>
        <p class="text-muted">PostgreSQL settings assessment with recommendations</p>
    </div>
</div>

<!-- Summary Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card h-100 border-danger">
            <div class="card-body text-center">
                <h6 class="card-subtitle mb-2 text-danger">Critical</h6>
                <h2 class="mb-0 {#if criticalCount > 0}text-danger{#else}text-muted{/if}">{criticalCount}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card h-100 border-warning">
            <div class="card-body text-center">
                <h6 class="card-subtitle mb-2 text-warning">Warnings</h6>
                <h2 class="mb-0 {#if warningCount > 0}text-warning{#else}text-muted{/if}">{warningCount}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card h-100 border-info">
            <div class="card-body text-center">
                <h6 class="card-subtitle mb-2 text-info">Suggestions</h6>
                <h2 class="mb-0 {#if infoCount > 0}text-info{#else}text-muted{/if}">{infoCount}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card h-100 border-success">
            <div class="card-body text-center">
                <h6 class="card-subtitle mb-2 text-success">Total Checked</h6>
                <h2 class="mb-0 text-success">{totalSettings}</h2>
            </div>
        </div>
    </div>
</div>

<!-- Settings by Category -->
{#for entry in groupedSettings.entrySet()}
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="bi {entry.value.get(0).categoryIconClass} me-2"></i>
            {entry.key.displayName}
        </h5>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
                <thead>
                    <tr>
                        <th style="width: 20%">Setting</th>
                        <th style="width: 15%">Current Value</th>
                        <th style="width: 10%">Status</th>
                        <th style="width: 15%">Recommended</th>
                        <th>Description / Recommendation</th>
                    </tr>
                </thead>
                <tbody>
                    {#for setting in entry.value}
                    <tr>
                        <td>
                            <code>{setting.name}</code>
                            <br>
                            <small class="text-muted">Source: {setting.source}</small>
                        </td>
                        <td>
                            <span class="{setting.statusTextClass}">
                                {setting.displayValue}
                            </span>
                        </td>
                        <td>
                            <span class="badge {setting.statusBadgeClass}">
                                {setting.statusDisplayName}
                            </span>
                        </td>
                        <td>
                            {#if setting.hasRecommendedValue}
                            <code class="text-success">{setting.recommendedValue}</code>
                            {#else}
                            <span class="text-muted">-</span>
                            {/if}
                        </td>
                        <td>
                            <small>{setting.description}</small>
                            {#if setting.hasRecommendation}
                            <div class="mt-1">
                                <span class="badge bg-secondary">
                                    <i class="bi bi-lightbulb me-1"></i>Recommendation
                                </span>
                                <small class="d-block mt-1 {setting.statusTextClass}">{setting.recommendation}</small>
                            </div>
                            {/if}
                        </td>
                    </tr>
                    {/for}
                </tbody>
            </table>
        </div>
    </div>
</div>
{/for}

<!-- Legend -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">Status Legend</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-3">
                <span class="badge bg-danger me-2">Critical</span>
                <span>Immediate action required. May cause data loss or downtime.</span>
            </div>
            <div class="col-md-3">
                <span class="badge bg-warning text-dark me-2">Warning</span>
                <span>Suboptimal setting that may impact performance.</span>
            </div>
            <div class="col-md-3">
                <span class="badge bg-info me-2">Info</span>
                <span>Suggestion for potential improvement.</span>
            </div>
            <div class="col-md-3">
                <span class="badge bg-success me-2">OK</span>
                <span>Setting is within acceptable range.</span>
            </div>
        </div>
    </div>
</div>

</div>

{/include}
