# PostgreSQL configuration
quarkus.datasource.db-kind=postgresql
quarkus.datasource.jdbc.url=${POSTGRES_URL:jdbc:postgresql://localhost:5432/postgres}
quarkus.datasource.username=${POSTGRES_USER:postgres}
quarkus.datasource.password=${POSTGRES_PASSWORD:postgres}

# HTTP Configuration
quarkus.http.port=8080
quarkus.http.host=0.0.0.0

# Qute Configuration
quarkus.qute.content-types.css=text/css;charset=utf-8
quarkus.qute.content-types.js=application/javascript;charset=utf-8

# Logging Configuration
# ======================

# Base log level
quarkus.log.level=INFO

# Console format for plain text mode
# Format: timestamp level [category] message
quarkus.log.console.format=%d{yyyy-MM-dd HH:mm:ss.SSS} %-5p [%c{2.}] (%X{correlationId}) %s%e%n

# File logging (when enabled)
quarkus.log.file.enabled=${PG_CONSOLE_LOG_FILE_ENABLED:false}
quarkus.log.file.path=${PG_CONSOLE_LOG_FILE_PATH:/var/log/pg-console}/pg-console.log
quarkus.log.file.format=%d{yyyy-MM-dd HH:mm:ss.SSS} %-5p [%c{2.}] (%X{correlationId}) %s%e%n
quarkus.log.file.rotation.max-file-size=${PG_CONSOLE_LOG_FILE_SIZE:10M}
quarkus.log.file.rotation.max-backup-index=${PG_CONSOLE_LOG_FILE_BACKUP:5}
quarkus.log.file.rotation.file-suffix=.yyyy-MM-dd

# Category-specific log levels
quarkus.log.category."com.bovinemagnet.pgconsole".level=INFO
quarkus.log.category."pgconsole".level=INFO
quarkus.log.category."pgconsole.SQL".level=DEBUG
quarkus.log.category."pgconsole.SECURITY".level=INFO
quarkus.log.category."pgconsole.AUDIT".level=INFO
quarkus.log.category."pgconsole.RESOURCES".level=INFO

# Reduce noise from framework loggers
quarkus.log.category."io.quarkus".level=WARN
quarkus.log.category."org.jboss".level=WARN
quarkus.log.category."io.netty".level=WARN
quarkus.log.category."io.vertx".level=WARN

# Enhanced Logging Configuration (pgconsole-logging prefix)
# ==========================================================

# Log format: 'json' for structured logging, 'plain' for human-readable
pgconsole-logging.format=${PG_CONSOLE_LOG_FORMAT:plain}

# File logging
pgconsole-logging.file.enabled=${PG_CONSOLE_LOG_FILE_ENABLED:false}
pgconsole-logging.file.path=${PG_CONSOLE_LOG_FILE_PATH:/var/log/pg-console}
pgconsole-logging.file.max-size=${PG_CONSOLE_LOG_FILE_SIZE:10M}
pgconsole-logging.file.max-backup=${PG_CONSOLE_LOG_FILE_BACKUP:5}
pgconsole-logging.file.file-name=pg-console.log
pgconsole-logging.file.error-log-enabled=${PG_CONSOLE_LOG_ERROR_FILE:false}
pgconsole-logging.file.error-file-name=pg-console-error.log

# SQL query logging
pgconsole-logging.sql.enabled=${PG_CONSOLE_LOG_SQL_ENABLED:false}
pgconsole-logging.sql.slow-threshold-ms=${PG_CONSOLE_LOG_SQL_SLOW_MS:1000}
pgconsole-logging.sql.log-parameters=${PG_CONSOLE_LOG_SQL_PARAMS:false}
pgconsole-logging.sql.max-query-length=2000

# Sensitive data redaction
pgconsole-logging.redact.enabled=${PG_CONSOLE_LOG_REDACT:true}
pgconsole-logging.redact.patterns=password,secret,token,key,credential,auth,apikey,api_key,bearer,jwt
pgconsole-logging.redact.replacement=[REDACTED]
pgconsole-logging.redact.mask-pii=${PG_CONSOLE_LOG_MASK_PII:false}
pgconsole-logging.redact.redact-connection-strings=true

# Async logging
pgconsole-logging.async.enabled=${PG_CONSOLE_LOG_ASYNC:true}
pgconsole-logging.async.queue-size=${PG_CONSOLE_LOG_ASYNC_QUEUE:1024}
pgconsole-logging.async.overflow-policy=BLOCK

# MDC context propagation
pgconsole-logging.mdc.correlation-id-enabled=true
pgconsole-logging.mdc.correlation-id-header=X-Correlation-ID
pgconsole-logging.mdc.include-user=true
pgconsole-logging.mdc.include-instance=true
pgconsole-logging.mdc.include-client-ip=true

# Performance logging
pgconsole-logging.performance.latency-logging-enabled=true
pgconsole-logging.performance.slow-threshold-ms=${PG_CONSOLE_LOG_SLOW_MS:5000}
pgconsole-logging.performance.resource-logging-enabled=${PG_CONSOLE_LOG_RESOURCES:false}
pgconsole-logging.performance.resource-logging-interval-seconds=60

# Application metadata
quarkus.application.name=pg-console
quarkus.application.version=1.0.0

# Database filter - comma-separated list of database names to monitor
# Leave unset or omit to show all non-template databases
# Examples:
#   pg-console.databases=postgres,myapp_prod
#   pg-console.databases=sim_prd_eplus
# Can also be set via environment variable: PG_CONSOLE_DATABASES
#pg-console.databases=

# Flyway Configuration
quarkus.flyway.migrate-at-start=true
quarkus.flyway.baseline-on-migrate=true
quarkus.flyway.schemas=pgconsole

# History Sampling Configuration
pg-console.history.enabled=${PG_CONSOLE_HISTORY_ENABLED:true}
pg-console.history.interval-seconds=${PG_CONSOLE_HISTORY_INTERVAL:60}
pg-console.history.retention-days=${PG_CONSOLE_HISTORY_RETENTION:7}
pg-console.history.top-queries=${PG_CONSOLE_HISTORY_TOP_QUERIES:50}

# Multi-Instance Configuration
# Comma-separated list of instance names (first one is the default)
# pg-console.instances=default,production,staging
pg-console.instances=${PG_CONSOLE_INSTANCES:default}

# Display names for instances (optional, defaults to instance name)
# pg-console.instance.production.display-name=Production DB
# pg-console.instance.staging.display-name=Staging DB

# Named datasources for additional instances:
# quarkus.datasource.production.db-kind=postgresql
# quarkus.datasource.production.jdbc.url=${POSTGRES_PRODUCTION_URL}
# quarkus.datasource.production.username=${POSTGRES_PRODUCTION_USER}
# quarkus.datasource.production.password=${POSTGRES_PRODUCTION_PASSWORD}

# Security Configuration
# Set to true to enable HTTP Basic authentication
pg-console.security.enabled=${PG_CONSOLE_SECURITY_ENABLED:false}

# Properties file authentication (when security is enabled)
quarkus.security.users.file.enabled=${pg-console.security.enabled}
quarkus.security.users.file.plain-text=true
quarkus.security.users.file.users=users.properties
quarkus.security.users.file.roles=roles.properties

# HTTP Basic Authentication (only enabled when security is enabled)
quarkus.http.auth.basic=${pg-console.security.enabled}

# Admin-only endpoints require admin role when security is enabled
quarkus.http.auth.permission.admin-actions.paths=/api/activity/*/cancel,/api/activity/*/terminate
quarkus.http.auth.permission.admin-actions.policy=role-policy-admin
quarkus.http.auth.permission.admin-actions.methods=POST
quarkus.http.auth.permission.admin-actions.enabled=${pg-console.security.enabled}

# Role policy requiring admin role
quarkus.http.auth.policy.role-policy-admin.roles-allowed=admin

# Development profile: disable security by default
%dev.pg-console.security.enabled=false

# Alerting Configuration
# Set to true to enable alerting
pg-console.alerting.enabled=${PG_CONSOLE_ALERTING_ENABLED:false}

# Webhook URL for sending alerts (JSON POST requests)
# pg-console.alerting.webhook-url=https://hooks.slack.com/services/xxx
# pg-console.alerting.webhook-url=${PG_CONSOLE_WEBHOOK_URL}

# Email for alerts (requires Quarkus mailer configuration)
# pg-console.alerting.email-to=ops@example.com

# Minimum seconds between alerts of the same type (prevents alert storms)
pg-console.alerting.cooldown-seconds=${PG_CONSOLE_ALERTING_COOLDOWN:300}

# Alerting Thresholds
pg-console.alerting.thresholds.connection-percent=${PG_CONSOLE_ALERT_CONN_PERCENT:90}
pg-console.alerting.thresholds.blocked-queries=${PG_CONSOLE_ALERT_BLOCKED:5}
pg-console.alerting.thresholds.long-query-seconds=${PG_CONSOLE_ALERT_LONG_QUERY:300}
pg-console.alerting.thresholds.cache-hit-ratio=${PG_CONSOLE_ALERT_CACHE_HIT:90}
