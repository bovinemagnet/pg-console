{#include base}
{#title}Forecasts - PostgreSQL Console{/title}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h3 mb-1">
            <i class="bi bi-graph-up text-primary me-2" aria-hidden="true"></i>
            Predictive Analytics
        </h1>
        <p class="text-muted mb-0">Forecasting and capacity planning</p>
    </div>
    <div class="d-flex gap-2">
        <a href="/insights?instance={instance}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-1" aria-hidden="true"></i>
            Back to Insights
        </a>
    </div>
</div>

<!-- Storage Growth Rate -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-hdd me-2" aria-hidden="true"></i>
                Storage Growth Analysis
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 text-center border-end">
                        <h6 class="text-muted mb-2">Daily Growth Rate</h6>
                        <h2 class="mb-0">
                            {#if dailyGrowthMb != null}
                            {dailyGrowthMb} MB/day
                            {#else}
                            N/A
                            {/if}
                        </h2>
                    </div>
                    <div class="col-md-4 text-center border-end">
                        <h6 class="text-muted mb-2">Weekly Projection</h6>
                        <h2 class="mb-0">
                            {#if weeklyGrowthGb != null}
                            {weeklyGrowthGb} GB
                            {#else}
                            N/A
                            {/if}
                        </h2>
                    </div>
                    <div class="col-md-4 text-center">
                        <h6 class="text-muted mb-2">Monthly Projection</h6>
                        <h2 class="mb-0">
                            {#if monthlyGrowthGb != null}
                            {monthlyGrowthGb} GB
                            {#else}
                            N/A
                            {/if}
                        </h2>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Storage Forecasts -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-database me-2" aria-hidden="true"></i>
                Storage Forecasts
            </div>
            <div class="card-body p-0">
                {#if storageForecasts.isEmpty}
                <div class="text-center text-muted py-5">
                    <i class="bi bi-clock-history display-4" aria-hidden="true"></i>
                    <p class="mt-3 mb-0">Insufficient historical data for forecasting</p>
                    <small>At least 7 days of data required</small>
                </div>
                {#else}
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Forecast Date</th>
                                <th>Predicted Value</th>
                                <th>Lower Bound</th>
                                <th>Upper Bound</th>
                                <th>Confidence</th>
                                <th>Model</th>
                            </tr>
                        </thead>
                        <tbody>
                            {#for forecast in storageForecasts}
                            <tr>
                                <td>{forecast.forecastDate}</td>
                                <td>
                                    <strong>{forecast.formattedValue}</strong>
                                </td>
                                <td>
                                    <small class="text-muted">{forecast.lowerBound / 1024 / 1024 / 1024} GB</small>
                                </td>
                                <td>
                                    <small class="text-muted">{forecast.upperBound / 1024 / 1024 / 1024} GB</small>
                                </td>
                                <td>
                                    <div class="progress" style="height: 20px; width: 100px;">
                                        <div class="progress-bar {#if forecast.highQuality}bg-success{#else if forecast.confidence > 0.5}bg-warning{#else}bg-danger{/if}"
                                             role="progressbar" style="width: {forecast.confidence * 100}%"
                                             aria-valuenow="{forecast.confidence * 100}" aria-valuemin="0" aria-valuemax="100">
                                            {forecast.confidence * 100}%
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span class="badge bg-secondary">{forecast.modelType}</span>
                                </td>
                            </tr>
                            {/for}
                        </tbody>
                    </table>
                </div>
                {/if}
            </div>
        </div>
    </div>
</div>

<!-- Connection Forecasts -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-plug me-2" aria-hidden="true"></i>
                Connection Forecasts
            </div>
            <div class="card-body p-0">
                {#if connectionForecasts.isEmpty}
                <div class="text-center text-muted py-5">
                    <i class="bi bi-clock-history display-4" aria-hidden="true"></i>
                    <p class="mt-3 mb-0">Insufficient historical data for forecasting</p>
                    <small>At least 7 days of data required</small>
                </div>
                {#else}
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Forecast Date</th>
                                <th>Predicted Connections</th>
                                <th>Lower Bound</th>
                                <th>Upper Bound</th>
                                <th>Confidence</th>
                                <th>Model</th>
                            </tr>
                        </thead>
                        <tbody>
                            {#for forecast in connectionForecasts}
                            <tr>
                                <td>{forecast.forecastDate}</td>
                                <td>
                                    <strong>{forecast.predictedValue}</strong>
                                </td>
                                <td>
                                    <small class="text-muted">{forecast.lowerBound}</small>
                                </td>
                                <td>
                                    <small class="text-muted">{forecast.upperBound}</small>
                                </td>
                                <td>
                                    <div class="progress" style="height: 20px; width: 100px;">
                                        <div class="progress-bar {#if forecast.highQuality}bg-success{#else if forecast.confidence > 0.5}bg-warning{#else}bg-danger{/if}"
                                             role="progressbar" style="width: {forecast.confidence * 100}%"
                                             aria-valuenow="{forecast.confidence * 100}" aria-valuemin="0" aria-valuemax="100">
                                            {forecast.confidence * 100}%
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span class="badge bg-secondary">{forecast.modelType}</span>
                                </td>
                            </tr>
                            {/for}
                        </tbody>
                    </table>
                </div>
                {/if}
            </div>
        </div>
    </div>
</div>

<!-- Forecasting Methodology -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-info-circle me-2" aria-hidden="true"></i>
                Forecasting Methodology
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h6><i class="bi bi-graph-up me-2" aria-hidden="true"></i>Linear Regression</h6>
                        <p class="text-muted small">
                            Uses historical data to fit a linear trend line. Best for metrics with
                            consistent growth patterns. The RÂ² value indicates model quality.
                        </p>
                    </div>
                    <div class="col-md-4">
                        <h6><i class="bi bi-shield-check me-2" aria-hidden="true"></i>Confidence Intervals</h6>
                        <p class="text-muted small">
                            Upper and lower bounds represent the 95% confidence interval.
                            Narrower intervals indicate more reliable predictions.
                        </p>
                    </div>
                    <div class="col-md-4">
                        <h6><i class="bi bi-calendar-event me-2" aria-hidden="true"></i>Data Requirements</h6>
                        <p class="text-muted small">
                            Forecasts require at least 7 days of historical data. More data
                            generally produces more accurate predictions.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{/include}
